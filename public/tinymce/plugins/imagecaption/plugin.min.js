! function() {
    "use strict";
    tinymce.PluginManager.add("imagecaption", function(t, n) {

        function _onAction()
        {
            // Open a Dialog
            t.windowManager.open({
                title: 'Imagen',
                body: {
                    type: 'panel',
                    items: [
                        {
                            type: 'input',
                            name: 'url',
                            inputMode: 'text',
                            label: 'Url de la imagen',
                        },
                        {
                            type: 'input',
                            name: 'caption',
                            inputMode: 'text',
                            label: 'Caption de la imagen',
                        },
                        {
                            type: 'input',
                            name: 'credits',
                            inputMode: 'text',
                            label: 'Cr√©ditos de la foto',
                        },
                ]
                },
                onSubmit: function (api) {
                    // insert markup
                    t.insertContent(`
                    <div style="width:80%; background-color:rgba(122, 122, 122, 0.07); margin: 0 auto">
                    <img src="${api.getData().url}" 
                    style="width: auto; max-width:100%; height: auto; display: block; margin-left: auto; margin-right: auto;">
                    </img>
                    </div>
                    <div style="margin: 0 0 20px 0">
                    <h6 
                    style="max-width: 80%; margin: 10px auto 0 auto; font-size: 12px; font-weight: 400; color: #7a7a7a !important">
                        ${api.getData().caption !== "" ? api.getData().caption : "Este es un caption de ejemplo"}
                    </h6>
                    <br>
                    ${api.getData().credits !== "" ? 
                        "<h6 style='max-width: 80%; margin: 0 auto; font-size: 12px; font-weight: 400; color: #7a7a7a !important'>" +
                        api.getData().credits + "</h6>"
                        : "<br>"
                    }
                    </div>
                    <p></p>
                    `);
        
                    // close the dialog
                    api.close();
                },
                buttons: [
                    {
                        text: 'Close',
                        type: 'cancel',
                        onclick: 'close'
                    },
                    {
                        text: 'Insert',
                        type: 'submit',
                        primary: true,
                    }
                ]
            });
        }
        t.ui.registry.addButton("imagecaption", {
            icon: "image",
            onAction: _onAction
        })
    })
}();